$.fn.awesomeRating=function(a){if(a=a||{},!a.values&&a.valueMax){a.values=[];for(var b=a.valueMin||1;b<=a.valueMax;b+=a.valueStep||1)a.values.push(b)}var c={values:[1,2,3,4,5],valueInitial:null,cssBase:"rating-star fa",cssBaseSelected:"fa-star",cssBaseUnselected:"fa-star-o",cssValuesSelected:["first-selected","second-selected","third-selected","forth-selected","fifth-selected"],cssValuesUnselected:["first-unselected","second-unselected","third-unselected","forth-unselected","fifth-unselected"],cssHover:"rating-star-hover",cssFractional:"rating-star-fractional",targetSelector:null,htmlBase:"<div></div>",htmlEvent:"click",applyHoverCss:!0,readonly:!1,allowFractional:!1,calculateFractional:null,eventName:"rated"};return this.each(function(){if(!this._awesomeRatingApi){var b=$(this),d={values:{list:a.values||c.values||[],initial:a.valueInitial||c.valueInitial||null,current:null},html:{base:a.htmlBase||c.htmlBase,event:a.htmlEvent||c.htmlEvent},css:{base:a.cssBase||c.cssBase,selected:a.cssBaseSelected||c.cssBaseSelected,unselected:a.cssBaseUnselected||c.cssBaseUnselected,values:{selected:a.cssValuesSelected||c.cssValuesSelected||[],unselected:a.cssValuesUnselected||c.cssValuesUnselected||[]},hover:a.cssHover||c.cssHover||null,fractional:a.cssFractional||c.cssFractional||null},settings:{applyHoverCss:a.applyHoverCss!==!1&&c.applyHoverCss,readonly:a.readonly||c.readonly||!1,allowFractional:a.allowFractional||c.allowFractional||!1,eventName:a.eventName||c.eventName||"rated"},external:{$:{element:b,target:$(a.targetSelector||c.targetSelector),rates:null,fractional:null},val:function(a){return void 0===a?d.values.current:void d.storeValue(a)}},temp:{$initial:null,fractionalIndex:-1},storeValue:function(a){a!==d.values.current&&(d.values.current=a,d.updateTarget(),d.triggerEvent(),d.updateFractionalIndex(),d.updateCss())},updateTarget:function(){d.external.$.target&&d.external.$.target.text(d.values.current)&&d.external.$.target.val(d.values.current)},triggerEvent:function(){d.external.$.element.trigger(d.settings.eventName,[d.values.current])},toggleBaseCss:function(){var a=null==d.values.current;d.external.$.rates.each(function(b){var c=$(this);!a&&d.settings.allowFractional&&(a=d.temp.fractionalIndex===b),c.toggleClass(d.css.selected,!a),c.toggleClass(d.css.unselected,a),d.css.values.selected.length==d.values.list.length&&d.css.values.unselected.length==d.values.list.length&&$.each(d.values.list,function(b,e){var f=d.settings.allowFractional?d.calculateFractional(d.values.current,d.values.list[b]):-1,g=f>0&&1>f;c.toggleClass(d.css.values.selected[b],!a&&(e===d.values.current||g)),c.toggleClass(d.css.values.unselected[b],a&&(e===d.values.current||g))}),d.values.list[b]===d.values.current&&(a=!0)})},toggleFractionalCss:function(){d.external.$.fractional.each(function(a){var b=$(this);if(a!==d.temp.fractionalIndex)b.hide();else{var c=d.calculateFractional(d.values.current,d.values.list[a]);b.css("display","initial"),b.width(c+"em")}})},updateCss:function(){d.toggleBaseCss(),d.settings.allowFractional&&d.toggleFractionalCss()},updateCssHover:function(a){d.external.$.rates.each(function(b){$(this).toggleClass(d.css.hover,a>=b)}),d.settings.allowFractional&&d.external.$.fractional.each(function(b){$(this).toggleClass(d.css.hover,a>=b)})},calculateFractional:a.calculateFractional||c.calculateFractional||function(a,b){return 1-(b-a)},updateFractionalIndex:function(){d.temp.fractionalIndex=-1,d.external.$.rates.each(function(a){if(-1===d.temp.fractionalIndex&&d.settings.allowFractional){var b=d.settings.allowFractional?d.calculateFractional(d.values.current,d.values.list[a]):-1;b>0&&1>b&&(d.temp.fractionalIndex=a)}})}};$.each(d.values.list,function(a,b){var c=d.external.$.element.append(d.html.base).find(":last-child");c.toggleClass(d.css.base,!0),c.toggleClass(d.css.unselected,!0),d.settings.readonly||(c.on(d.html.event,function(){d.storeValue(b)}),d.settings.applyHoverCss&&c.hover(function(){d.updateCssHover(a)},function(){d.updateCssHover(-1)}))}),d.external.$.rates=d.external.$.element.children(),d.settings.allowFractional&&d.external.$.rates.each(function(a){var b=$(this).before(d.html.base).prev();b.toggleClass(d.css.base,!0),b.toggleClass(d.css.fractional,!0),b.toggleClass(d.css.selected,!0),d.css.values.selected.length==d.values.list.length&&d.css.values.unselected.length==d.values.list.length&&b.toggleClass(d.css.values.selected[a]),d.settings.readonly||(b.on(d.html.event,function(){d.storeValue(d.values.list[a])}),d.settings.applyHoverCss&&b.hover(function(){d.updateCssHover(a)},function(){d.updateCssHover(-1)}))}),d.external.$.fractional=d.external.$.element.find("."+d.css.fractional),d.storeValue(d.values.initial),this._awesomeRatingApi=d.external}})},angular.module("awesome-rating",[]).directive("awesomeRating",["$timeout",function(a){return{restrict:"A",scope:{awesomeRating:"=",awesomeRatingOptions:"@"},link:function(b,c){var d=b.awesomeRatingOptions&&JSON.parse(b.awesomeRatingOptions)||{};d.valueInitial=b.awesomeRating,$element=$(c).awesomeRating(d).on("rated",function(c,d){a(function(){b.awesomeRating=d})}),b.$watch("awesomeRating",function(a){$element.each(function(){this._awesomeRatingApi.val(a)})})}}}]);